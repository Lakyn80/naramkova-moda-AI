(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{3377:function(e,t,a){Promise.resolve().then(a.bind(a,9742))},9742:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var r=a(7437),n=a(7138),o=a(2265),s=a(6463),l=a(6264),i=a(3480);function c(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),[a,c]=(0,o.useState)([]),[d,u]=(0,o.useState)([]),[h,m]=(0,o.useState)(!0),[p,f]=(0,o.useState)(null),[y,x]=(0,o.useState)(null),[g,v]=(0,o.useState)(null),[b,j]=(0,o.useState)(()=>t.get("search")||""),[w,N]=(0,o.useState)(()=>t.get("category")||""),[k,S]=(0,o.useState)(()=>t.get("stock")||"all"),[E,P]=(0,o.useState)(()=>{let e=Number(t.get("page")||"1");return Number.isFinite(e)&&e>0?e:1});(0,o.useEffect)(()=>{let e=!0;return m(!0),f(null),Promise.all([(0,l.t2)(),(0,l.pE)()]).then(t=>{let[a,r]=t;e&&(c(a),u(r))}).catch(t=>{e&&f(t.message||"Nepodařilo se nač\xedst produkty")}).finally(()=>{e&&m(!1)}),()=>{e=!1}},[]),(0,o.useEffect)(()=>{let e=t.get("search")||"",a=t.get("category")||"",r=t.get("stock")||"all",n=Number(t.get("page")||"1"),o=Number.isFinite(n)&&n>0?n:1;e!==b&&j(e),a!==w&&N(a),r!==k&&S(r),o!==E&&P(o)},[t,b,w,k,E]);let O=t=>{var a,r,n,o;let s=new URLSearchParams,l=null!==(a=t.search)&&void 0!==a?a:b,i=null!==(r=t.category)&&void 0!==r?r:w,c=null!==(n=t.stock)&&void 0!==n?n:k,d=null!==(o=t.page)&&void 0!==o?o:E;l&&s.set("search",l),i&&s.set("category",i),c&&"all"!==c&&s.set("stock",c),d&&d>1&&s.set("page",String(d));let u=s.toString();e.replace(u?"?".concat(u):"?",{scroll:!1})},T=(0,o.useMemo)(()=>{let e=[...a],t=b.trim().toLowerCase();t&&(e=e.filter(e=>{var a;return null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(t)}));let r=Number(w);return Number.isFinite(r)&&r>0&&(e=e.filter(e=>e.category_id===r)),"in_stock"===k&&(e=e.filter(e=>{var t;return(null!==(t=e.stock)&&void 0!==t?t:0)>0})),"out_stock"===k&&(e=e.filter(e=>{var t;return(null!==(t=e.stock)&&void 0!==t?t:0)<=0})),e.sort((e,t)=>{var a,r;return(null!==(a=t.id)&&void 0!==a?a:0)-(null!==(r=e.id)&&void 0!==r?r:0)}),e},[a,b,w,k]),C=Math.max(1,Math.ceil(T.length/20)),z=Math.min(E,C),_=T.slice((z-1)*20,20*z);(0,o.useEffect)(()=>{E!==z&&(P(z),O({page:z}))},[E,z]);let R="1"===t.get("created"),M=async e=>{if(window.confirm("Opravdu smazat tento produkt?")){x(null),v(e);try{await (0,l.Ir)(e),c(t=>t.filter(t=>t.id!==e))}catch(e){x(e instanceof Error?e.message:"Smaz\xe1n\xed selhalo")}finally{v(null)}}},D=e=>{P(1),O({...e,page:1})};return(0,r.jsx)("main",{className:"min-h-screen bg-gray-50 text-gray-900",children:(0,r.jsxs)("div",{className:"mx-auto max-w-6xl px-6 py-10",children:[(0,r.jsxs)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"\uD83D\uDCE6 Produkty"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Seznam produktů z API."})]}),(0,r.jsx)(n.default,{href:"/admin/products/new",className:"rounded-md bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700",children:"➕ Přidat produkt"})]}),R&&(0,r.jsx)("div",{className:"mb-4 rounded-md border border-emerald-200 bg-emerald-50 p-4 text-sm text-emerald-700",children:"Produkt byl \xfaspěšně vytvořen."}),y&&(0,r.jsx)("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 p-4 text-sm text-red-600",children:y}),(0,r.jsx)("div",{className:"mb-4 rounded-2xl border border-gray-200 bg-gradient-to-br from-gray-50 to-slate-50 p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase text-gray-500",children:"Hledat n\xe1zev"}),(0,r.jsx)("input",{type:"text",value:b,onChange:e=>{j(e.target.value),D({search:e.target.value})},className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm",placeholder:"např. křišť\xe1l"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase text-gray-500",children:"Kategorie"}),(0,r.jsxs)("select",{value:w,onChange:e=>{N(e.target.value),D({category:e.target.value})},className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"",children:"— Všechny —"}),d.map(e=>(0,r.jsx)("option",{value:e.id,children:(e.group||"—")+" — "+e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase text-gray-500",children:"Sklad"}),(0,r.jsxs)("select",{value:k,onChange:e=>{S(e.target.value),D({stock:e.target.value})},className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"all",children:"Vše"}),(0,r.jsx)("option",{value:"in_stock",children:"Skladem"}),(0,r.jsx)("option",{value:"out_stock",children:"Vyprod\xe1no"})]})]}),(0,r.jsxs)("div",{className:"flex items-end gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{j(""),N(""),S("all"),P(1),O({search:"",category:"",stock:"all",page:1})},className:"rounded-md border border-gray-300 px-3 py-2 text-sm",children:"Reset filtrů"}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[T.length," produktů"]})]})]})}),h&&(0,r.jsx)("div",{className:"rounded-md border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Nač\xedt\xe1n\xed..."}),p&&(0,r.jsx)("div",{className:"rounded-md border border-red-200 bg-red-50 p-6 text-sm text-red-600",children:p}),!h&&!p&&(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-100 text-left text-xs font-semibold uppercase tracking-wider text-gray-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"ID"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"N\xe1zev"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Kategorie"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Cena"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Sklad"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Obr\xe1zek"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"M\xe9dia"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Akce"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:_.map(e=>{var t,a,o,s,l;let c=(0,i.X)(e.image_url),d=null!==(a=null===(t=e.media)||void 0===t?void 0:t.length)&&void 0!==a?a:0,u=null==(s=e.stock)?{label:"—",className:"bg-gray-100 text-gray-600"}:s>5?{label:"Skladem: ".concat(s),className:"bg-emerald-500 text-white"}:s>0?{label:"Skladem: ".concat(s),className:"bg-amber-400 text-gray-900"}:{label:"Vyprod\xe1no",className:"bg-red-500 text-white"};return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-gray-600",children:e.id}),(0,r.jsx)("td",{className:"px-4 py-3 font-medium",children:e.name}),(0,r.jsx)("td",{className:"px-4 py-3",children:null!==(o=e.category_name)&&void 0!==o?o:"—"}),(0,r.jsx)("td",{className:"px-4 py-3",children:null==(l=e.price)?"-":"".concat(l.toFixed(2)," Kč")}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("span",{className:"inline-flex items-center rounded-full px-3 py-1 text-xs ".concat(u.className),children:u.label})}),(0,r.jsx)("td",{className:"px-4 py-3",children:c?(0,r.jsx)("div",{className:"h-14 w-14 overflow-hidden rounded-lg shadow",children:(0,r.jsx)("img",{src:c,alt:e.name,className:"h-full w-full object-cover"})}):(0,r.jsx)("div",{className:"h-14 w-14 rounded-lg bg-gray-100"})}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[d," souborů"]}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(n.default,{href:"/admin/products/".concat(e.id,"/edit"),className:"rounded-md border border-gray-300 px-3 py-1 text-xs hover:bg-gray-100",children:"Upravit"}),(0,r.jsx)("button",{type:"button",onClick:()=>M(e.id),disabled:g===e.id,className:"rounded-md border border-red-200 px-3 py-1 text-xs text-red-700 hover:bg-red-50 disabled:opacity-60",children:g===e.id?"Mažu...":"Smazat"})]})})]},e.id)})})]})}),!h&&!p&&C>1&&(0,r.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3 text-sm",children:[(0,r.jsxs)("div",{children:["Str\xe1nka ",z," / ",C," \xb7 Zobrazeno ",_.length," z ",T.length]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{let e=Math.max(1,z-1);P(e),O({page:e})},disabled:z<=1,className:"rounded-md border border-gray-300 px-3 py-1 disabled:opacity-50",children:"Předchoz\xed"}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e=Math.min(C,z+1);P(e),O({page:e})},disabled:z>=C,className:"rounded-md border border-gray-300 px-3 py-1 disabled:opacity-50",children:"Dalš\xed"})]})]})]})})}function d(){return(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)("main",{className:"min-h-screen bg-gray-50 text-gray-900",children:(0,r.jsx)("div",{className:"mx-auto max-w-6xl px-6 py-10",children:(0,r.jsx)("div",{className:"rounded-md border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Nač\xedt\xe1n\xed..."})})}),children:(0,r.jsx)(c,{})})}},6264:function(e,t,a){"use strict";a.d(t,{$Y:function(){return E},Bd:function(){return T},Dj:function(){return g},Hy:function(){return S},Ir:function(){return f},MX:function(){return l},QX:function(){return O},RA:function(){return y},SN:function(){return P},TE:function(){return x},c0:function(){return N},cQ:function(){return k},cW:function(){return j},f8:function(){return o},gF:function(){return w},h6:function(){return b},jn:function(){return i},k4:function(){return d},nM:function(){return p},pE:function(){return c},ry:function(){return m},t2:function(){return s},uu:function(){return h},yr:function(){return u},zm:function(){return v}});let r="/api",n=r.includes("backend")?"/api":r;function o(e){let t=e.startsWith("/")?e:"/".concat(e);return"/api"===n?t.startsWith("/api/")||"/api"===t?t:"/api".concat(t):"".concat(n).concat(t)}async function s(){let e=await fetch(o("/api/products/"),{cache:"no-store"});if(!e.ok)throw Error("Nepodařilo se nač\xedst produkty (".concat(e.status,")"));return await e.json()}async function l(e){let t=await fetch(o("/api/products/".concat(e)),{cache:"no-store"});if(!t.ok)throw Error("Nepodařilo se nač\xedst produkt (".concat(t.status,")"));return await t.json()}async function i(e){let t=await fetch(o("/api/categories/".concat(e)),{cache:"no-store"});if(!t.ok)throw Error("Nepodařilo se nač\xedst kategorii (".concat(t.status,")"));return await t.json()}async function c(){let e=await fetch(o("/api/categories/"),{cache:"no-store"});if(!e.ok)throw Error("Nepodařilo se nač\xedst kategorie (".concat(e.status,")"));return await e.json()}async function d(e){let t=await fetch(o("/api/categories/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Nepodařilo se vytvořit kategorii (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}return await t.json()}async function u(e,t){let a=await fetch(o("/api/categories/".concat(e)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e="Nepodařilo se uložit kategorii (".concat(a.status,")");try{let t=await a.json();e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||(null==t?void 0:t.detail)||e}catch(e){}throw Error(e)}return await a.json()}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=await fetch(o(t?"/api/categories/".concat(e,"?force=true"):"/api/categories/".concat(e)),{method:"DELETE"});if(!a.ok){let e="Nepodařilo se smazat kategorii (".concat(a.status,")");try{let t=await a.json();e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||(null==t?void 0:t.detail)||e}catch(e){}throw Error(e)}}async function m(e){let t=await fetch(o("/api/products/"),{method:"POST",body:e});if(!t.ok){let e="Nepodařilo se vytvořit produkt (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}return await t.json()}async function p(e,t){let a=await fetch(o("/api/products/".concat(e)),{method:"PUT",body:t});if(!a.ok){let e="Nepodařilo se uložit produkt (".concat(a.status,")");try{let t=await a.json();e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||(null==t?void 0:t.detail)||e}catch(e){}throw Error(e)}return await a.json()}async function f(e){let t=await fetch(o("/api/products/".concat(e)),{method:"DELETE"});if(!t.ok){let e="Nepodařilo se smazat produkt (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}async function y(e){let t=await fetch(o("/api/ai/vision/analyze"),{method:"POST",body:e});if(!t.ok){let e="Anal\xfdza obr\xe1zku selhala (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}return await t.json()}async function x(e){let t=await fetch(o("/api/ai/deepseek/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:e})});if(!t.ok){let e="Generov\xe1n\xed popisu selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}return await t.json()}async function g(e){await fetch(o("/api/ai/rag/ingest"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function v(e){let t=await fetch(o("/api/ai/rag/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Vyhled\xe1v\xe1n\xed v RAG selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}return t.json()}async function b(e){let t=await fetch(o("/api/media/".concat(e)),{method:"DELETE"});if(!t.ok){let e="Smaz\xe1n\xed m\xe9dia selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}async function j(e){let t=await fetch(o("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Přihl\xe1šen\xed selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}async function w(e){let t=await fetch(o("/api/auth/forgot"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Odesl\xe1n\xed odkazu selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}async function N(e){let t=await fetch(o("/api/auth/reset"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Reset hesla selhal (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}async function k(e){var t,a,r,n;let s=new URLSearchParams;e.vs&&s.set("vs",e.vs),e.status&&"all"!==e.status&&s.set("status",e.status),e.limit&&s.set("per_page",String(e.limit));let l=await fetch(o("/api/payments?".concat(s.toString())),{cache:"no-store"});if(!l.ok)throw Error("Nepodařilo se nač\xedst platby (".concat(l.status,")"));let i=await l.json();return{items:(null==i?void 0:i.items)||(null==i?void 0:i.rows)||(null==i?void 0:i.data)||[],total:null!==(a=null!==(t=null==i?void 0:i.total)&&void 0!==t?t:null==i?void 0:i.count)&&void 0!==a?a:null,page:null!==(r=null==i?void 0:i.page)&&void 0!==r?r:null,per_page:null!==(n=null==i?void 0:i.per_page)&&void 0!==n?n:null}}async function S(){var e,t,a;let r=await fetch(o("/api/payments/summary"),{cache:"no-store"});if(!r.ok)return null;let n=await r.json();return{count:null!==(e=null==n?void 0:n.count)&&void 0!==e?e:null,total_amount:null!==(a=null!==(t=null==n?void 0:n.total_amount)&&void 0!==t?t:null==n?void 0:n.totalAmount)&&void 0!==a?a:null}}async function E(e){let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,r]=e;r&&t.set(a,r)});let a=await fetch(o("/api/sold?".concat(t.toString())),{cache:"no-store"});if(!a.ok)throw Error("Nepodařilo se nač\xedst prodan\xe9 (".concat(a.status,")"));let r=await a.json();return{rows:(null==r?void 0:r.rows)||(null==r?void 0:r.items)||(null==r?void 0:r.data)||[],summary:(null==r?void 0:r.summary)||null}}function P(e,t){let a=new URLSearchParams;return Object.entries(t).forEach(e=>{let[t,r]=e;r&&a.set(t,r)}),o("/api/sold/export/".concat(e,"?").concat(a.toString()))}function O(e){return o("/api/sold/".concat(e,"/invoice-preview"))}async function T(e){let t=await fetch(o("/api/sold/".concat(e,"/invoice-send")),{method:"POST"});if(!t.ok){let e="Odesl\xe1n\xed faktury selhalo (".concat(t.status,")");try{let a=await t.json();e=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||e}catch(e){}throw Error(e)}}},3480:function(e,t,a){"use strict";function r(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/static/")?e:"/static/uploads/".concat(e):null}a.d(t,{X:function(){return r}})},7138:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var r=a(231),n=a.n(r)},6463:function(e,t,a){"use strict";var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=3377)}),_N_E=e.O()}]);