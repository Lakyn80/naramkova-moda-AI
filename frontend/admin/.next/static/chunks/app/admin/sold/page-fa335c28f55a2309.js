(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[395],{4551:function(t,e,a){Promise.resolve().then(a.bind(a,7648))},7648:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return c}});var n=a(7437),o=a(2265),r=a(6463),l=a(6264);function s(t){return null==t?"-":"".concat(Number(t).toFixed(2)," Kč")}function i(){var t,e;let a=(0,r.useSearchParams)(),[i,c]=(0,o.useState)([]),[d,u]=(0,o.useState)(null),[h,p]=(0,o.useState)(!0),[m,f]=(0,o.useState)(null),[y,x]=(0,o.useState)(null),v=a.get("from")||"",g=a.get("to")||"";(0,o.useEffect)(()=>{let t=!0;return p(!0),f(null),(0,l.$Y)({from:v,to:g}).then(e=>{t&&(c(e.rows||[]),u(e.summary||null))}).catch(e=>{t&&f(e.message||"Nepodařilo se nač\xedst prodan\xe9")}).finally(()=>{t&&p(!1)}),()=>{t=!1}},[v,g]);let w=(t,e)=>{let a=new URLSearchParams;t&&a.set("from",t),e&&a.set("to",e);let n=a.toString();window.location.href=n?"/admin/sold?".concat(n):"/admin/sold"},b=async t=>{x(t);try{await (0,l.Bd)(t)}catch(t){alert(t instanceof Error?t.message:"Odesl\xe1n\xed selhalo")}finally{x(null)}},j=(0,l.SN)("xlsx",{from:v,to:g}),N=(0,l.SN)("pdf",{from:v,to:g});return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold",children:"Prodan\xe9"}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border border-gray-200 bg-white p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm font-medium",children:"Od:"}),(0,n.jsx)("input",{type:"date",value:v,onChange:t=>w(t.target.value,g),className:"rounded border border-gray-300 px-2 py-1 text-sm"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm font-medium",children:"Do:"}),(0,n.jsx)("input",{type:"date",value:g,onChange:t=>w(v,t.target.value),className:"rounded border border-gray-300 px-2 py-1 text-sm"})]}),(0,n.jsx)("button",{type:"button",onClick:()=>w("",""),className:"rounded border border-gray-300 px-3 py-1 text-sm hover:bg-gray-50",children:"Reset"}),(0,n.jsx)("a",{href:j,target:"_blank",rel:"noreferrer",className:"rounded border border-emerald-300 bg-emerald-50 px-3 py-1 text-sm text-emerald-700 hover:bg-emerald-100",children:"Export Excel"}),(0,n.jsx)("a",{href:N,target:"_blank",rel:"noreferrer",className:"rounded border border-blue-300 bg-blue-50 px-3 py-1 text-sm text-blue-700 hover:bg-blue-100",children:"Export PDF"})]}),d&&(0,n.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4 text-sm",children:["Počet: ",(0,n.jsx)("strong",{children:null!==(t=d.count)&&void 0!==t?t:0})," | Celkem:"," ",(0,n.jsx)("strong",{children:s(null!==(e=d.total_amount)&&void 0!==e?e:0)})]}),h&&(0,n.jsx)("div",{className:"rounded-md border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Nač\xedt\xe1n\xed..."}),m&&(0,n.jsx)("div",{className:"rounded-md border border-red-200 bg-red-50 p-4 text-sm text-red-600",children:m}),!h&&!m&&(0,n.jsxs)("div",{className:"overflow-x-auto rounded-lg border border-gray-200 bg-white",children:[(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"ID"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"Produkt"}),(0,n.jsx)("th",{className:"px-4 py-2 text-right font-semibold",children:"Ks"}),(0,n.jsx)("th",{className:"px-4 py-2 text-right font-semibold",children:"Cena/ks"}),(0,n.jsx)("th",{className:"px-4 py-2 text-right font-semibold",children:"Celkem"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"Email"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"VS"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"Datum"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left font-semibold",children:"Akce"})]})}),(0,n.jsx)("tbody",{children:i.map(t=>{var e,a,o,r,i,c,d;return(0,n.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,n.jsx)("td",{className:"px-4 py-2",children:t.id}),(0,n.jsx)("td",{className:"px-4 py-2",children:null!==(e=t.product_name)&&void 0!==e?e:"-"}),(0,n.jsx)("td",{className:"px-4 py-2 text-right",children:null!==(a=t.quantity)&&void 0!==a?a:0}),(0,n.jsx)("td",{className:"px-4 py-2 text-right",children:s(null!==(r=null!==(o=t.unit_price_czk)&&void 0!==o?o:t.unit_price)&&void 0!==r?r:t.price_czk)}),(0,n.jsx)("td",{className:"px-4 py-2 text-right",children:s(t.total_czk)}),(0,n.jsx)("td",{className:"px-4 py-2 text-xs",children:null!==(i=t.customer_email)&&void 0!==i?i:"-"}),(0,n.jsx)("td",{className:"px-4 py-2",children:null!==(c=t.vs)&&void 0!==c?c:"-"}),(0,n.jsx)("td",{className:"px-4 py-2 text-xs",children:t.sold_at?t.sold_at.slice(0,16).replace("T"," "):"-"}),(0,n.jsx)("td",{className:"px-4 py-2",children:t.id&&(0,n.jsxs)("span",{className:"flex gap-1",children:[(0,n.jsx)("a",{href:(0,l.QX)(t.id),target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"Faktura"}),(0,n.jsx)("button",{type:"button",onClick:()=>b(t.id),disabled:y===t.id,className:"text-emerald-600 hover:underline disabled:opacity-50",children:y===t.id?"Odes\xedl\xe1m...":"E-mail"})]})})]},null!==(d=t.id)&&void 0!==d?d:Math.random())})})]}),0===i.length&&(0,n.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Ž\xe1dn\xe9 prodan\xe9 položky"})]})]})}function c(){return(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)("div",{className:"rounded-md border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Nač\xedt\xe1n\xed..."}),children:(0,n.jsx)(i,{})})}},6264:function(t,e,a){"use strict";a.d(e,{$Y:function(){return S},Bd:function(){return T},Dj:function(){return v},Hy:function(){return E},Ir:function(){return f},MX:function(){return s},QX:function(){return O},RA:function(){return y},SN:function(){return P},TE:function(){return x},c0:function(){return N},cQ:function(){return k},cW:function(){return b},f8:function(){return r},gF:function(){return j},h6:function(){return w},jn:function(){return i},k4:function(){return d},nM:function(){return m},pE:function(){return c},ry:function(){return p},t2:function(){return l},uu:function(){return h},yr:function(){return u},zm:function(){return g}});let n="/api",o=n.includes("backend")?"/api":n;function r(t){let e=t.startsWith("/")?t:"/".concat(t);return"/api"===o?e.startsWith("/api/")||"/api"===e?e:"/api".concat(e):"".concat(o).concat(e)}async function l(){let t=await fetch(r("/api/products/"),{cache:"no-store"});if(!t.ok)throw Error("Nepodařilo se nač\xedst produkty (".concat(t.status,")"));return await t.json()}async function s(t){let e=await fetch(r("/api/products/".concat(t)),{cache:"no-store"});if(!e.ok)throw Error("Nepodařilo se nač\xedst produkt (".concat(e.status,")"));return await e.json()}async function i(t){let e=await fetch(r("/api/categories/".concat(t)),{cache:"no-store"});if(!e.ok)throw Error("Nepodařilo se nač\xedst kategorii (".concat(e.status,")"));return await e.json()}async function c(){let t=await fetch(r("/api/categories/"),{cache:"no-store"});if(!t.ok)throw Error("Nepodařilo se nač\xedst kategorie (".concat(t.status,")"));return await t.json()}async function d(t){let e=await fetch(r("/api/categories/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t="Nepodařilo se vytvořit kategorii (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}return await e.json()}async function u(t,e){let a=await fetch(r("/api/categories/".concat(t)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let t="Nepodařilo se uložit kategorii (".concat(a.status,")");try{let e=await a.json();t=(null==e?void 0:e.error)||(null==e?void 0:e.message)||(null==e?void 0:e.detail)||t}catch(t){}throw Error(t)}return await a.json()}async function h(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=await fetch(r(e?"/api/categories/".concat(t,"?force=true"):"/api/categories/".concat(t)),{method:"DELETE"});if(!a.ok){let t="Nepodařilo se smazat kategorii (".concat(a.status,")");try{let e=await a.json();t=(null==e?void 0:e.error)||(null==e?void 0:e.message)||(null==e?void 0:e.detail)||t}catch(t){}throw Error(t)}}async function p(t){let e=await fetch(r("/api/products/"),{method:"POST",body:t});if(!e.ok){let t="Nepodařilo se vytvořit produkt (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}return await e.json()}async function m(t,e){let a=await fetch(r("/api/products/".concat(t)),{method:"PUT",body:e});if(!a.ok){let t="Nepodařilo se uložit produkt (".concat(a.status,")");try{let e=await a.json();t=(null==e?void 0:e.error)||(null==e?void 0:e.message)||(null==e?void 0:e.detail)||t}catch(t){}throw Error(t)}return await a.json()}async function f(t){let e=await fetch(r("/api/products/".concat(t)),{method:"DELETE"});if(!e.ok){let t="Nepodařilo se smazat produkt (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}async function y(t){let e=await fetch(r("/api/ai/vision/analyze"),{method:"POST",body:t});if(!e.ok){let t="Anal\xfdza obr\xe1zku selhala (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}return await e.json()}async function x(t){let e=await fetch(r("/api/ai/deepseek/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:t})});if(!e.ok){let t="Generov\xe1n\xed popisu selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}return await e.json()}async function v(t){await fetch(r("/api/ai/rag/ingest"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async function g(t){let e=await fetch(r("/api/ai/rag/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t="Vyhled\xe1v\xe1n\xed v RAG selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}return e.json()}async function w(t){let e=await fetch(r("/api/media/".concat(t)),{method:"DELETE"});if(!e.ok){let t="Smaz\xe1n\xed m\xe9dia selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}async function b(t){let e=await fetch(r("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t="Přihl\xe1šen\xed selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}async function j(t){let e=await fetch(r("/api/auth/forgot"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t="Odesl\xe1n\xed odkazu selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}async function N(t){let e=await fetch(r("/api/auth/reset"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t="Reset hesla selhal (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}async function k(t){var e,a,n,o;let l=new URLSearchParams;t.vs&&l.set("vs",t.vs),t.status&&"all"!==t.status&&l.set("status",t.status),t.limit&&l.set("per_page",String(t.limit));let s=await fetch(r("/api/payments?".concat(l.toString())),{cache:"no-store"});if(!s.ok)throw Error("Nepodařilo se nač\xedst platby (".concat(s.status,")"));let i=await s.json();return{items:(null==i?void 0:i.items)||(null==i?void 0:i.rows)||(null==i?void 0:i.data)||[],total:null!==(a=null!==(e=null==i?void 0:i.total)&&void 0!==e?e:null==i?void 0:i.count)&&void 0!==a?a:null,page:null!==(n=null==i?void 0:i.page)&&void 0!==n?n:null,per_page:null!==(o=null==i?void 0:i.per_page)&&void 0!==o?o:null}}async function E(){var t,e,a;let n=await fetch(r("/api/payments/summary"),{cache:"no-store"});if(!n.ok)return null;let o=await n.json();return{count:null!==(t=null==o?void 0:o.count)&&void 0!==t?t:null,total_amount:null!==(a=null!==(e=null==o?void 0:o.total_amount)&&void 0!==e?e:null==o?void 0:o.totalAmount)&&void 0!==a?a:null}}async function S(t){let e=new URLSearchParams;Object.entries(t).forEach(t=>{let[a,n]=t;n&&e.set(a,n)});let a=await fetch(r("/api/sold?".concat(e.toString())),{cache:"no-store"});if(!a.ok)throw Error("Nepodařilo se nač\xedst prodan\xe9 (".concat(a.status,")"));let n=await a.json();return{rows:(null==n?void 0:n.rows)||(null==n?void 0:n.items)||(null==n?void 0:n.data)||[],summary:(null==n?void 0:n.summary)||null}}function P(t,e){let a=new URLSearchParams;return Object.entries(e).forEach(t=>{let[e,n]=t;n&&a.set(e,n)}),r("/api/sold/export/".concat(t,"?").concat(a.toString()))}function O(t){return r("/api/sold/".concat(t,"/invoice-preview"))}async function T(t){let e=await fetch(r("/api/sold/".concat(t,"/invoice-send")),{method:"POST"});if(!e.ok){let t="Odesl\xe1n\xed faktury selhalo (".concat(e.status,")");try{let a=await e.json();t=(null==a?void 0:a.error)||(null==a?void 0:a.message)||(null==a?void 0:a.detail)||t}catch(t){}throw Error(t)}}},6463:function(t,e,a){"use strict";var n=a(1169);a.o(n,"useParams")&&a.d(e,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(e,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(e,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(e,{useSearchParams:function(){return n.useSearchParams}})}},function(t){t.O(0,[971,23,744],function(){return t(t.s=4551)}),_N_E=t.O()}]);